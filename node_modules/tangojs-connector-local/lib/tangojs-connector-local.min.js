"use strict";!function(e,t){if("function"==typeof define&&define.amd)define(["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var n={exports:{}};t(n.exports),e.tangojsConnectorLocal=n.exports}}(this,function(e){function t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":i(t))&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":i(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function u(e,t,n){return 1===t?e:Object.keys(e).reduce(function(r,o){var c=e[o],a=void 0;return"object"!==("undefined"==typeof c?"undefined":i(c))||null==c?(a={},a[o]=c):!function(){var r=u(e[o],t-1,n);a=Object.keys(r).reduce(function(e,t){return e[""+o+n+t]=r[t],e},{})}(),Object.assign(r,a)},{})}function o(e){return Promise.reject(new Error(e))}Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function e(e,t){var n=[],r=!0,i=!1,u=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(a){i=!0,u=a}finally{try{!r&&c["return"]&&c["return"]()}finally{if(i)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=function(e){return Promise.resolve(Array.isArray(e)?e:[e])},s=function(e){return(Array.isArray(e)?e:[e]).map(function(e){return e instanceof tangojs.struct.DbDatum?e.name:"string"==typeof e||e instanceof String?e:""}).filter(function(e){return""!==e})},l=function(e){return new RegExp(e.replace("*",".*"),"g")},v=new RegExp("/","g"),y=function(){function e(t){r(this,e),this._model=t}return a(e,[{key:"getDevice",value:function(e){try{var t=e.split("/"),n=c(t,3),r=n[0],i=n[1],u=n[2];return Promise.resolve(this._model[r][i][u])}catch(a){return o("Invalid device name: '"+name+"'")}}},{key:"getAttribute",value:function(e,t){return this.getDevice(e).then(function(n){return n.attributes&&n.attributes[t]?n.attributes[t]:o("Attribute not found: '"+e+"/"+t+"'")})}},{key:"getCommand",value:function(e,t){return this.getDevice(e).then(function(n){return n.commands&&n.commands[t]?n.commands[t]:o("Command not found: '"+e+"/"+t+"'")})}},{key:"getProperty",value:function(e,t){return this.getDevice(e).then(function(n){return n.properties&&n.properties[t]?n.properties[t]:o("Property not found: '"+e+"/"+t+"'")})}},{key:"getDeviceNameList",value:function(){var e=Object.keys(u(this._model,3,"/")).filter(function(e){return 2===(e.match(v)||[]).length});return Promise.resolve(e)}}]),e}(),_=function(e){function i(e,n){r(this,i);var u=t(this,Object.getPrototypeOf(i).call(this));return u._model=e,u._tree=n||new y(e),u}return n(i,e),a(i,[{key:"get_device_status",value:function(e){return this._tree.getDevice(e).then(function(e){return e.get_status()})}},{key:"get_device_state",value:function(e){return this._tree.getDevice(e).then(function(e){return e.get_state()})}},{key:"get_device_info",value:function(e){return this._tree.getDevice(e).then(function(e){return e.get_info()})}},{key:"get_device_list",value:function(e){var t=l(e);return this._tree.getDeviceNameList().then(function(e){return e.filter(function(e){return e.match(t)})})}},{key:"get_device_domain",value:function(e){throw new Error(e)}},{key:"get_device_family",value:function(e){throw new Error(e)}},{key:"get_device_member",value:function(e){throw new Error(e)}},{key:"get_device_property_list",value:function(e,t){var n=l(t);return this._tree.getDevice(e).then(function(e){return Object.keys(e.properties).filter(function(e){return e.match(n)})})}},{key:"get_device_property",value:function(e,t){var n=this,r=s(t).map(function(t){return n._tree.getProperty(e,t)});return Array.isArray(t)?Promise.all(r):r[0]}},{key:"put_device_property",value:function(e,t){return this._tree.getDevice(e).then(function(e){e.properties=e.properties||{},e.properties[t.name]=t})}},{key:"delete_device_property",value:function(e,t){return this._tree.getDevice(e).then(function(e){s(t).forEach(function(t){delete e.properties[t]})})}},{key:"get_device_attribute_list",value:function(e){return this._tree.getDevice(e).then(function(e){return Object.keys(e.attributes)})}},{key:"get_device_attribute_info",value:function(e,t){var n=this,r=t?f(t):this.get_device_attribute_list(e);return r.then(function(t){return Promise.all(t.map(function(t){return n._tree.getAttribute(e,t).then(function(e){return e.get_info()})}))}).then(function(e){return t?Array.isArray(t)?e:e[0]:e})}},{key:"read_device_attribute",value:function(e,t){var n=this;return f(t).then(function(t){return Promise.all(t.map(function(t){return n._tree.getAttribute(e,t).then(function(e){return e.get_value()})}))}).then(function(e){return Array.isArray(t)?e:e[0]})}},{key:"write_device_attribute",value:function(e,t){var n=this;return f(t).then(function(e){return e.map(function(e){return[e.name,e.value]})}).then(function(t){return Promise.all(t.map(function(t){var r=c(t,2),i=r[0],u=r[1];return n._tree.getAttribute(e,i).then(function(e){return e.set_value(u)})}))})}},{key:"write_read_device_attribute",value:function(e,t){throw new Error("not implemented yet")}},{key:"device_command_inout",value:function(e,t,n){return this._tree.getCommand(e,t).then(function(e){return e.inout(n)})}},{key:"device_command_query",value:function(e,t){return this._tree.getCommand(e,t).then(function(e){return e.get_info()})}},{key:"device_command_list_query",value:function(e){var t=this;return this._tree.getDevice(e).then(function(e){return Object.keys(e.commands)}).then(function(n){return Promise.all(n.map(function(n){return t._tree.getCommand(e,n).then(function(e){return e.get_info()})}))})}}]),i}(tangojs.Connector);e.LocalConnector=_});
//# sourceMappingURL=tangojs-connector-local.min.js.map
